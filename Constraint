REM DEFAULT OPTION
-- INSERT할 때 암시적으로 NULL이 들어가면 자동으로 대체될 값을 지정할 때 사용
-- DEFAULT 값은 해당 칼럼의 데이터타입과 일치해야 한다.

CREATE TABLE EMP_COPY10
( EMPNO NUMBER(4),
    ENAME VARCHAR2(20),
    HIREDATE DATE DEFAULT SYSDATE,
    JOB VARCHAR2(50) DEFAULT 'DEVELOPER',
    SAL NUMBER(7) DEFAULT 800000
);

INSERT INTO EMP_COPY10 (EMPNO, ENAME)
VALUES(1111, '한지민'); -- 암시적으로 NULL 삽입

INSERT INTO EMP_COPY10 (EMPNO, ENAME, JOB)
VALUES(2222, '김지민', 'SALESEMAN');

INSERT INTO EMP_COPY10 (EMPNO, ENAME, JOB, HIREDATE)
VALUES(3333, '박지민', NULL, NULL);
-- JOB과 HIREDATE는 명시적으로 NULL을 넣었다.
-- 명시적으로 넣었기 때문에 DEFAULT OPTION이 적용되지 않는다.

SELECT* FROM EMP_COPY10;

CREATE TABLE MEMBER -- 테이블 복사, 구조만 복사, 테이블을 복사해서 생성하면 모든 제약조건이 삭제된다.
AS
SELECT EMPNO, ENAME
FROM EMP
WHERE 1=0;

-- 성별 컬럼을 추가하고 기본값을 여성으로 설정
ALTER TABLE MEMBER
ADD (GENDER NUMBER(1));
ALTER TABLE MEMBER
MODIFY (GENDER VARCHAR2(7) DEFAULT '여성');

ALTER TABLE MEMBER
ADD (GENDER VARCHAR2(7) DEFAULT '여성');

INSERT INTO MEMBER(EMPNO, ENAME)
VALUES (1111, '한지민');

INSERT INTO MEMBER(EMPNO, ENAME, GENDER)
VALUES (2222, '박지민', '남성');

INSERT INTO MEMBER(EMPNO, ENAME, GENDER)
VALUES (3333, '김지민', DEFAULT); -- 명시적으로 DEFAULT를 넣어도 가능ㄴ

DESC MEMBER;
SELECT * FROM MEMBER;

DROP TABLE EMP_COPY10;
DROP TABLE MEMBER;

REM PRIMARY KEY
-- 1. COLUMN-LEVEL 제약 조건으로 생성하기
CREATE TABLE MEMBER(
    USERID CHAR(14) PRIMARY KEY,
    PASSWD VARCHAR2(20),
    NAME VARCHAR2(20),
    AGE NUMBER(2),
    CITY VARCHAR2(20) DEFAULT 'SEOUL'
);

SELECT TABLE_NAME FROM USER_TABLES;
DESC USER_CONSTRAINTS;
SELECT OWNER, CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME
FROM USER_CONSTRAINTS
WHERE TABLE_NAME=UPPER('MEMBER');

REM 제약조건 이름 부여하기
-- 테이블 이름_컬럼이름_PK | UK | NN | FK | CK

-- COLUMN-LEVEL 제약조건으로 생성하기
CREATE TABLE MEMBER(
    USERID CHAR(14) CONSTRAINT MEMBER_USERID_PK PRIMARY KEY,
    PASSWD VARCHAR2(20),
    NAME VARCHAR2(20),
    AGE NUMBER(2),
    CITY VARCHAR2(20) DEFAULT 'SEOUL'
);

-- TABLE-LEVEL 제약조건으로 생성하기
CREATE TABLE MEMBER(
    USERID CHAR(14),
    PASSWD VARCHAR2(20),
    NAME VARCHAR2(20),
    AGE NUMBER(2),
    CITY VARCHAR2(20) DEFAULT 'SEOUL',
    CONSTRAINT MEMBER_USERID_PK PRIMARY KEY(USERID)
);

INSERT INTO MEMBER(USERID, PASSWD)
VALUES(1111, '12345');

INSERT INTO MEMBER(USERID, PASSWD)
VALUES (1111, '44444');

INSERT INTO MEMBER(USERID, PASSWD)
VALUES (NULL, '55555');


CREATE TABLE PRODUCT(
    PRODUCTID CHAR(7),
    NAME VARCHAR2(30),
    PRICE NUMBER(8) DEFAULT 0,
    PDATE DATE DEFAULT SYSDATE,
    MAKER VARCHAR2(20),
    CONSTRAINT PRODUCT_PRODUCTID_PK PRIMARY KEY(PRODUCTID)
);

-- 테이블 복사해서 테이블을 생성한 후, 새로 생성한 테이블에는 제약조건이 삭제됐으니,
-- 새로 제약조건을 추가하는 방법
CREATE TABLE EMP_COPY10
AS
SELECT EMPNO, ENAME, JOB, HIREDATE
FROM EMP
WHERE DEPTNO = 10;

ALTER TABLE EMP_COPY10
ADD CONSTRAINT EMP_COPY10_EMPNO_PK PRIMARY KEY (EMPNO);

SELECT OWNER, CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME
FROM USER_CONSTRAINTS
WHERE TABLE_NAME=UPPER('EMP_COPY10');

SELECT *
FROM EMP_COPY10;

INSERT INTO EMP_COPY10 (EMPNO, ENAME)
VALUES (7782, '한지민');

-- 제약 조건 삭제는 이름으로
ALTER TABLE EMP_COPY10
DROP CONSTRAINT EMP_COPY10_EMPNO_pk;

-- NOT NULL 
-- ADD CONSTRAINT 절대 안됨.
ALTER TABLE EMP_COPY10
-- MODIFY (ENAME NOT NULL);
MODIFY ENAME CONSTRAINT EMP_COPY10_ENAME_NN NOT NULL;

CREATE TABLE PATIENT(
    BUNHO NUMBER(4), 
    NAME VARCHAR2(20) CONSTRAINT PATIENT_NAME_NN NOT NULL,
    CODE CHAR(2) CONSTRAINT PATIENT_CODE_NN NOT NULL,
    AGE NUMBER(3)CONSTRAINT PATIENT_AGE_NN NOT NULL,
    DAYS NUMBER(3) CONSTRAINT PATIENT_DAYS_NN NOT NULL,
    CONSTRAINT PATIENT_BUNHO_PK PRIMARY KEY(BUNHO)
);
